<!DOCTYPE html>
<html lang="en">


  <head>

    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">


    <title>게시판</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
 
    <style>
      table {
        border-collapse: collapse; /* 셀 구분선을 합칩니다 */
        width: 100%; /* 테이블의 너비를 화면 전체로 설정합니다 */
        margin: 0 5px; /* 테이블의 양쪽 마진을 10px로 설정합니다 */
      }
      table, th, td {
        border: 1px solid black; /* 테이블과 셀에 모두 외곽선을 추가합니다 */
      }
      .left-aligned-cell { /* 새로운 클래스 추가 */
      text-align: left; /* 텍스트를 좌측에 맞춥니다 */
      } 
  
      input, textarea {
      border: 1px solid black !important;  /* 외곽선의 너비를 2px로 설정합니다 */
      }
      </style>

  </head>
  <body>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.5/firebase-storage.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>   
    <script>
      const firebaseConfig = 
      {
        apiKey: "AIzaSyCRLoGsE02q2LgqO7JZOaPZkdKG1ibVl4o",
        authDomain: "hyihomepage.firebaseapp.com",
        databaseURL: "https://hyihomepage-default-rtdb.firebaseio.com",
        projectId: "hyihomepage",
        storageBucket: "hyihomepage.firebasestorage.app",
        messagingSenderId: "175712717780",
        appId: "1:175712717780:web:8b775bded241f7043ba441",
        measurementId: "G-JJ3ZDL0X2F"
        };
      firebase.initializeApp(firebaseConfig); 
    </script>
    
  <div class="container mt-5 mb-3">
    <h4> 게시판</h4>
    <table id="posts" style="text-align: center; border: 2px solid black;">
      <tr>
        <th style="font-weight: bold; width: 100px;">No.</th>
        <th style="font-weight: bold; width: 400px;">제목</th>
        <th style="font-weight: bold; width: 1500px;">내용</th>
        <th style="font-weight: bold; width: 100px;">작성자</th>
        <th style="font-weight: bold; width: 150px;">Date</th>
      </tr>
       <!-- 이곳에 게시물이 동적 추가 -->
    </table>
    <button class="btn btn-primary mt-5" id="towrite">글 쓰기</button>
  </div>

<!-- paginate -->
  <div class="container">
    <div id="productList" class="m-3"></div>
    <div class="m-3">
      <button id="prevPage">뒤로가기</button>

      <span id="currentPage" style="margin: 10px 10px;"></span>
      <button id="nextPage" class="btn btn-sm btn-outline-danger">다음 페이지</button>
      <span id="space" style="margin: 10px 10px;"></span>
      <button id="writeNew" class="btn btn-sm btn-primary">글 쓰기</button>
    </div>
  </div>



  <script>
  var db = firebase.firestore();

    // 한페이지에 표시할 게시글 수
  var pageSize = 2;
  var firstVisible;
  var lastVisible;  // 마지막 표시된 항목
  var currentPage = 1; 


  var navigationStack = [];

  function readPosts() {
    var query = db.collection("posts").orderBy("postNumber", "desc").limit(pageSize);


    if (currentPage > 1 && lastVisible) {
      // 다음 페이지로 갈 때: 마지막 게시글 이후부터 가져옴
      query = query.startAfter(lastVisible);
  } else if (currentPage < navigationStack.length && lastVisible) {
      // 이전 페이지로 갈 때: 이전 스택의 마지막 게시글 이전을 기준으로 가져옴
      query = query.endBefore(firstVisible);
  }
    // if (lastVisible) {
    //     query = query.startAfter(lastVisible);
    // } else if (firstVisible && currentPage < 1) {
    //    query = query.endBefore(firstVisible);
    // }

    query.get().then((querySnapshot) => {
      if (!querySnapshot.empty) {
          // 현재 페이지의 첫번째와 마지막 게시글을 저장
          firstVisible = querySnapshot.docs[0];
          lastVisible = querySnapshot.docs[querySnapshot.docs.length - 1];

          if (currentPage > navigationStack.length) {
              // 스택에 저장 (nextPage로 이동할 때만 저장)
              navigationStack.push({ firstVisible, lastVisible });
          }
      }
    // 게시글 테이블 업데이트
    var postsTable = document.getElementById('posts');
      while (postsTable.rows.length > 1) {
          postsTable.deleteRow(postsTable.rows.length - 1);
      }


      querySnapshot.forEach((doc) => {
        var row = postsTable.insertRow();
        var postNumberCell = row.insertCell();
        var titleCell = row.insertCell();
        var contentCell = row.insertCell();
          contentCell.className = 'left-aligned-cell';  // CSS 클래스 추가
          contentCell.textContent = doc.data().content;
        var authorCell = row.insertCell();  
        var createdAtCell = row.insertCell();
        postNumberCell.textContent = doc.data().postNumber;
        titleCell.textContent = doc.data().title;
        contentCell.textContent = doc.data().content;
        authorCell.textContent = doc.data().author;  
        createdAtCell.textContent = doc.data().createdAt.toDate().toLocaleString();  
      });
  }).catch((error) => {
     console.error("Error reading posts: ", error);
  });
}
    
  function updatePageNumber() {
    document.getElementById('currentPage').textContent = "현재 페이지: " + currentPage;
  }

// 이전 페이지로 이동
$('#prevPage').click(function () {
    if (currentPage > 1) {
        currentPage--;
        var previousVisible = navigationStack[currentPage - 1]; // 스택에서 이전 페이지 정보 가져옴
        firstVisible = previousVisible.firstVisible;
        lastVisible = previousVisible.lastVisible;
        readPosts();
        updatePageNumber();
    }
});

  window.onload = function() {
      readPosts();
      updatePageNumber();
    }

  $('#nextPage').click(function() {
    currentPage++;
    readPosts( );
    updatePageNumber();
  });


  $('#writeNew').click(function () {      
          setTimeout(() => window.location.href = "/boardwrite.html", 100)
  });
    
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>




<!-- 복구용 -->

<!-- var query = db.collection("posts").orderBy("postNumber", "desc").limit(pageSize);
    

if (lastVisible) {
    query = query.startAfter(lastVisible);
} else if (firstVisible && currentPage < 1) {
   query = query.endBefore(firstVisible);
}

query.get().then((querySnapshot) => {
      if (!querySnapshot.empty) {
        firstVisible = querySnapshot.docs[0];
          lastVisible = querySnapshot.docs[querySnapshot.docs.length-1];
      }

var postsTable = document.getElementById('posts');

while (postsTable.rows.length > 1) {  // 기존에 추가된 게시물을 제거합니다
  postsTable.deleteRow(postsTable.rows.length - 1);
}

querySnapshot.forEach((doc) => {
  var row = postsTable.insertRow();
  var postNumberCell = row.insertCell();
  var titleCell = row.insertCell();
  var contentCell = row.insertCell();
    contentCell.className = 'left-aligned-cell';  // CSS 클래스 추가
    contentCell.textContent = doc.data().content;
  var authorCell = row.insertCell();  
  var createdAtCell = row.insertCell();
  postNumberCell.textContent = doc.data().postNumber;
  titleCell.textContent = doc.data().title;
  contentCell.textContent = doc.data().content;
  authorCell.textContent = doc.data().author;  
  createdAtCell.textContent = doc.data().createdAt.toDate().toLocaleString();  
});
}).catch((error) => {
 console.error("Error reading posts: ", error);
});
}

function updatePageNumber() {
document.getElementById('currentPage').textContent = "현재 페이지: " + currentPage;
}

window.onload = function() {
  readPosts();
  updatePageNumber();
}

$('#nextPage').click(function() {
currentPage++;
readPosts( );
updatePageNumber();
});

$('#writeNew').click(function () {      
      setTimeout(() => window.location.href = "/boardwrite.html", 100)
});

</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html> -->